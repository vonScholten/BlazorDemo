@using BlazorDemo.Shared
@inject HttpClient Http

<div class="row">
    <div class="col-lg-6 col-md-12 mb-2">
        <form class="card text-center">
            <img src="@user.Img" class="card-img-top" alt="Profile picture">
            <div class="card-header">                
                <h5>
                    @user.FullName
                </h5>                
            </div>
            <div class="card-body p-3">
                <div class="row">

                    <div class="col-sm">
                        <EditForm EditContext="@_editContext" OnValidSubmit="HandleValidSubmit">
                            <DataAnnotationsValidator />

                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">
                                        @@
                                    </span>
                                </div>
                                <InputText @bind-Value="user.Username" class="form-control" placeholder="Username"></InputText>
                            </div>

                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">First and last name</span>
                                </div>
                                <InputText @bind-Value="user.FirstName" class="form-control" placeholder="First"></InputText>
                                <InputText @bind-Value="user.LastName" class="form-control" placeholder="Last"></InputText>
                            </div>

                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">
                                        <i class="oi oi-calendar" />
                                    </span>
                                </div>
                                <InputDate @bind-Value="user.Birthday" class="form-control"></InputDate>
                            </div>

                            <div class="input-group mb-3">
                                <InputText @bind-Value="user.Email" class="form-control" placeholder="Mail"></InputText>
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1">
                                        @@example.com
                                    </span>
                                </div>
                            </div>

                            <div class="text-center">
                                <button type="submit" disabled="@_formInvalid" class="btn btn-danger rounded-0 py-2 px-4"
                                        @onclick="@(() => Save())">
                                    Submit
                                </button>
                            </div>

                        </EditForm>
                    </div>

                </div>
            </div>
        </form>
    </div>
</div>

@code {
    [Parameter]
    public UserModel user { get; set; }

    private bool _formInvalid = true;
    private EditContext _editContext;


    protected override void OnInitialized()
    {
        _editContext = new EditContext(user);
        _editContext.OnFieldChanged += (_, __) =>
        {
            _formInvalid = !_editContext.Validate();
            StateHasChanged();
        };
    }

    private async Task Save()
    {
            await Http.PostJsonAsync("person", user);
            Console.WriteLine("Saved");
    }

    private void HandleValidSubmit()
    {
        Console.WriteLine("OnValidSubmit");
    }
}
